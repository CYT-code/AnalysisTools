<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鋼構 H 型鋼斷面性質計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        /* Modern Clean Look */
        :root {
            --primary-bg: #f5f5f7;
            --card-bg: rgba(255, 255, 255, 0.75);
            --card-border: rgba(255, 255, 255, 0.8);
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --accent-blue: #0071e3;
            --accent-green: #34c759;
            --accent-orange: #ff9500;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #eef2f5;
            background-image: 
                radial-gradient(at 0% 0%, rgba(200,210,230,0.3) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(200,210,230,0.3) 0px, transparent 50%);
            min-height: 100vh;
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
        }

        /* Glass / Neumorphism Hybrid Card */
        .pro-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 
                0 4px 24px -1px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .pro-card:hover {
            box-shadow: 
                0 10px 40px -5px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.9);
        }

        /* Inputs */
        .input-group label {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }

        .pro-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 1rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            color: var(--text-main);
            transition: all 0.2s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
            font-family: "SF Mono", ui-monospace, monospace;
        }
        
        .pro-input:focus {
            outline: none;
            background: #fff;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15);
        }

        /* Stats Typography */
        .stat-value {
            font-family: "SF Pro Display", sans-serif;
            font-weight: 600;
            letter-spacing: -0.03em;
            color: var(--text-main);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .stat-unit {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-left: 2px;
        }

        /* SVG Styles */
        .dim-line { stroke: #ff3b30; stroke-width: 1.5; }
        .dim-text { 
            fill: #ff3b30; 
            font-family: "SF Mono", Menlo, monospace; 
            font-size: 12px; 
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(255,255,255,0.9);
        }
        .axis-line { stroke: #3b82f6; stroke-width: 1; stroke-dasharray: 6,4; opacity: 0.7; }
        .axis-label { fill: #3b82f6; font-size: 12px; font-weight: bold; opacity: 0.8; }
        
        .steel-fill { 
            fill: url(#steelGradient); 
            stroke: #6b7280; 
            stroke-width: 1; 
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.15));
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 1rem;
            margin-bottom: 1.25rem;
            border-bottom: 1px solid rgba(0,0,0,0.06);
        }

        /* Table Styling */
        .list-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #86868b;
            font-weight: 600;
            padding: 12px 8px;
            background: rgba(255,255,255,0.5);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            white-space: nowrap;
        }
        .list-table td {
            padding: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            white-space: nowrap;
        }
        .list-input {
            width: 100%;
            min-width: 60px;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            font-family: "SF Mono", monospace;
            font-size: 0.9rem;
            background: rgba(255,255,255,0.8);
        }
        .list-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(0,113,227,0.1);
        }
        .cell-output {
            font-family: "SF Pro Display", sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            color: #1d1d1f;
        }

        .view-toggle-btn {
            padding: 6px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }
        .view-toggle-btn.active { background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); color: #1d1d1f; }
        .view-toggle-btn.inactive { color: #86868b; background: transparent; }
        .view-toggle-btn.inactive:hover { color: #1d1d1f; background: rgba(255,255,255,0.3); }

    </style>
</head>
<body class="p-4 md:p-8 flex justify-center">

    <!-- Widened container to 96% for better list view -->
    <div class="w-full max-w-[96%] flex flex-col gap-6">
        
        <!-- HEADER -->
        <div class="flex flex-col md:flex-row justify-between items-end pb-2 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Section Properties</h1>
                <p class="text-gray-500 text-sm mt-1">H 型鋼專業計算工具</p>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="bg-gray-200/50 p-1 rounded-xl flex">
                    <button onclick="switchView('detail')" id="btn-detail" class="view-toggle-btn active">詳細模式</button>
                    <button onclick="switchView('list')" id="btn-list" class="view-toggle-btn inactive">列表模式</button>
                </div>
                <div class="hidden md:flex items-center gap-2 bg-white/60 px-3 py-1.5 rounded-full border border-white/50 backdrop-blur-sm">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-xs font-semibold text-gray-600">Pro 1.0</span>
                </div>
            </div>
        </div>

        <!-- === VIEW: DETAIL === -->
        <div id="view-detail" class="grid grid-cols-1 lg:grid-cols-12 gap-8 max-w-7xl mx-auto w-full">
            
            <!-- LEFT COLUMN -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Inputs -->
                <div class="pro-card p-6">
                    <div class="section-title">
                        <i class="fa-solid fa-sliders text-blue-500"></i> 參數設定
                    </div>

                    <div class="space-y-5">
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>深度 H (mm)</label>
                                    <input type="number" id="inputH" class="pro-input" value="300" oninput="calculate()">
                                </div>
                                <div class="input-group">
                                    <label>寬度 B (mm)</label>
                                    <input type="number" id="inputB" class="pro-input" value="150" oninput="calculate()">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>腹板厚 tw (mm)</label>
                                    <input type="number" id="inputTw" class="pro-input" value="6.5" step="0.5" oninput="calculate()">
                                </div>
                                <div class="input-group">
                                    <label>翼板厚 tf (mm)</label>
                                    <input type="number" id="inputTf" class="pro-input" value="9" step="1" oninput="calculate()">
                                </div>
                            </div>
                        </div>

                        <div class="w-full h-px bg-gray-200"></div>

                        <div class="input-group">
                            <label class="flex justify-between">
                                <span>降伏強度 Fy (tf/cm²)</span>
                                <span class="text-[10px] bg-gray-200 px-1.5 py-0.5 rounded text-gray-500">MATERIAL</span>
                            </label>
                            <input type="number" id="inputFy" class="pro-input font-bold text-blue-600" value="3.3" step="0.1" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="pro-card p-8 flex flex-col justify-center items-center bg-white/40 relative min-h-[340px]">
                    <div class="absolute top-5 left-5 text-[10px] font-bold text-gray-400 tracking-widest uppercase">Real-time Preview</div>
                    
                    <svg id="sectionSvg" width="280" height="280" viewBox="0 0 300 300">
                        <defs>
                            <linearGradient id="steelGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#d1d5db;stop-opacity:1" />
                                <stop offset="30%" style="stop-color:#f3f4f6;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#e5e7eb;stop-opacity:1" />
                                <stop offset="70%" style="stop-color:#f9fafb;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#9ca3af;stop-opacity:1" />
                            </linearGradient>
                            <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                                <path d="M0,0 L6,3 L0,6" style="fill:#FF3B30;" />
                            </marker>
                        </defs>
                        <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
                            <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                            <feOffset dx="2" dy="4" result="offsetblur"/>
                            <feComponentTransfer><feFuncA type="linear" slope="0.2"/></feComponentTransfer>
                            <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
                        </filter>
                        <g id="axisGroup"></g>
                        <path id="steelPath" d="" class="steel-fill" />
                        <g id="dimLines"></g>
                    </svg>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="lg:col-span-8 space-y-6">
                <!-- Stats Banner -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="pro-card p-5 bg-gradient-to-br from-white to-gray-50 border-l-4 border-l-gray-400 flex flex-col justify-between">
                        <div class="stat-label mb-1">斷面積 Area</div>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-bold text-gray-800 tracking-tight" id="resA">--</span>
                            <span class="text-sm text-gray-500 font-medium">cm²</span>
                        </div>
                    </div>
                    <div class="pro-card p-5 bg-gradient-to-br from-white to-gray-50 border-l-4 border-l-gray-800 flex flex-col justify-between">
                        <div class="stat-label mb-1">單位重 Unit Weight</div>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-bold text-gray-800 tracking-tight" id="resWeight">--</span>
                            <span class="text-sm text-gray-500 font-medium">kg/m</span>
                        </div>
                    </div>
                </div>

                <!-- Geometric Grid -->
                <div class="pro-card p-6">
                    <div class="section-title justify-between">
                        <span><i class="fa-solid fa-cube text-indigo-500"></i> 斷面幾何性質</span>
                        <span class="text-[10px] px-2 py-1 bg-gray-100 rounded text-gray-400 font-normal">UNIT: cm</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Strong Axis -->
                        <div class="space-y-4">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                                <span class="text-xs font-bold text-blue-600 uppercase tracking-wider">Strong Axis (X-X)</span>
                            </div>
                            <div class="bg-gray-50/50 rounded-xl p-4 border border-gray-100 space-y-4 hover:bg-white transition-colors">
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">慣性矩 Ix</span>
                                    <div><span class="stat-value text-xl" id="resIx">--</span> <span class="stat-unit">cm⁴</span></div>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">迴轉半徑 rx</span>
                                    <div><span class="stat-value text-xl" id="resRx">--</span> <span class="stat-unit">cm</span></div>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">彈性模數 Sx</span>
                                    <div><span class="stat-value text-xl" id="resSx">--</span> <span class="stat-unit">cm³</span></div>
                                </div>
                                <div class="flex justify-between items-center text-blue-700">
                                    <span class="stat-label text-blue-600 font-semibold">塑性模數 Zx</span>
                                    <div><span class="stat-value text-xl" id="resZx">--</span> <span class="stat-unit text-blue-500">cm³</span></div>
                                </div>
                            </div>
                        </div>
                        <!-- Weak Axis -->
                        <div class="space-y-4">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                <span class="text-xs font-bold text-green-600 uppercase tracking-wider">Weak Axis (Y-Y)</span>
                            </div>
                            <div class="bg-gray-50/50 rounded-xl p-4 border border-gray-100 space-y-4 hover:bg-white transition-colors">
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">慣性矩 Iy</span>
                                    <div><span class="stat-value text-xl" id="resIy">--</span> <span class="stat-unit">cm⁴</span></div>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">迴轉半徑 ry</span>
                                    <div><span class="stat-value text-xl" id="resRy">--</span> <span class="stat-unit">cm</span></div>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                                    <span class="stat-label">彈性模數 Sy</span>
                                    <div><span class="stat-value text-xl" id="resSy">--</span> <span class="stat-unit">cm³</span></div>
                                </div>
                                <div class="flex justify-between items-center text-green-700">
                                    <span class="stat-label text-green-600 font-semibold">塑性模數 Zy</span>
                                    <div><span class="stat-value text-xl" id="resZy">--</span> <span class="stat-unit text-green-500">cm³</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strength Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Mp + Lp -->
                    <div class="pro-card p-6 bg-gradient-to-br from-blue-50/80 to-white border border-blue-100 relative overflow-hidden group">
                        <div class="absolute -right-6 -top-6 w-24 h-24 bg-blue-500 rounded-full opacity-10 blur-2xl group-hover:opacity-20 transition-opacity"></div>
                        <div class="section-title border-none mb-2 text-blue-900">
                            <i class="fa-solid fa-rotate-left"></i> 塑性彎矩 (Moment)
                        </div>
                        <div class="mt-2">
                            <div class="text-xs font-bold text-blue-400 mb-1">Mpx (Strong Axis)</div>
                            <div class="flex items-baseline">
                                <span class="text-4xl font-bold text-blue-600 tracking-tight" id="resMpx">--</span>
                                <span class="text-lg text-blue-400 ml-2 font-medium">tf-m</span>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-blue-100">
                            <div class="flex justify-between items-baseline mb-3">
                                <span class="text-xs font-bold text-gray-500">Mpy (Weak Axis)</span>
                                <div>
                                    <span class="text-xl font-bold text-gray-600" id="resMpy">--</span>
                                    <span class="text-xs text-gray-400 ml-1">tf-m</span>
                                </div>
                            </div>
                            
                            <!-- Lp Section -->
                            <div class="bg-blue-50/50 rounded-lg p-3 border border-blue-100">
                                <div class="flex items-center gap-1.5 mb-1">
                                    <i class="fa-solid fa-arrows-left-right text-xs text-blue-400"></i>
                                    <span class="text-xs font-bold text-blue-700">側向支撐距離 Lp</span>
                                    <span class="text-[10px] text-blue-400 border border-blue-200 px-1 rounded">13.6.7</span>
                                </div>
                                <div class="flex items-baseline">
                                    <span class="text-2xl font-bold text-gray-800" id="resLp">--</span>
                                    <span class="text-xs text-gray-500 ml-1">cm</span>
                                </div>
                                <div class="text-[10px] text-gray-400 mt-1">Formula: 170 × ry / Fy</div>
                            </div>
                        </div>
                    </div>

                    <!-- Vp -->
                    <div class="pro-card p-6 bg-gradient-to-br from-green-50/80 to-white border border-green-100 relative overflow-hidden group">
                        <div class="absolute -right-6 -top-6 w-24 h-24 bg-green-500 rounded-full opacity-10 blur-2xl group-hover:opacity-20 transition-opacity"></div>
                        <div class="section-title border-none mb-2 text-green-900">
                            <i class="fa-solid fa-arrows-up-down"></i> 塑性剪力 (Shear)
                        </div>
                        <div class="mt-2">
                            <div class="text-xs font-bold text-green-400 mb-1">SHEAR CAPACITY (Vp)</div>
                            <div class="flex items-baseline">
                                <span class="text-4xl font-bold text-green-600 tracking-tight" id="resVp">--</span>
                                <span class="text-lg text-green-400 ml-2 font-medium">tf</span>
                            </div>
                        </div>
                        <div class="mt-6 pt-4 border-t border-green-100">
                            <div class="flex items-start gap-2 text-[10px] text-gray-400 leading-tight">
                                <i class="fa-solid fa-circle-info mt-0.5"></i>
                                <span>計算採腹板全深 (H×tw)。僅供斷面塑性檢核，不含挫屈分析。</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === VIEW: LIST === -->
        <div id="view-list" class="hidden animate-fade-in space-y-6">
            <div class="pro-card p-6 min-h-[500px]">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold text-gray-800">批次計算列表</h2>
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">多斷面模式</span>
                    </div>
                    <div class="flex gap-3">
                         <button onclick="addListRow()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold shadow hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fa-solid fa-plus"></i> 新增一列
                        </button>
                        <button onclick="copyTableData()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-semibold shadow-sm hover:bg-gray-50 transition flex items-center gap-2">
                            <i class="fa-regular fa-copy"></i> 複製數據
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto border border-gray-200 rounded-xl">
                    <table class="w-full list-table text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="w-10 text-center">#</th>
                                <th class="w-20">H (mm)</th>
                                <th class="w-20">B (mm)</th>
                                <th class="w-16">tw (mm)</th>
                                <th class="w-16">tf (mm)</th>
                                <th class="w-20 border-r border-gray-200">Fy (tf/cm²)</th>
                                <!-- Results -->
                                <th>Area (cm²)</th>
                                <th>Wt (kg/m)</th>
                                <th>Ix (cm⁴)</th>
                                <th>Iy (cm⁴)</th>
                                <th class="text-blue-600">rx (cm)</th>
                                <th class="text-green-600">ry (cm)</th>
                                <th class="text-blue-600">Zx (cm³)</th>
                                <th class="text-green-600">Zy (cm³)</th>
                                <th>Mpx (tf-m)</th>
                                <th>Mpy (tf-m)</th>
                                <th>Vp (tf)</th>
                                <th class="bg-blue-50 text-blue-700 font-bold border-l border-blue-100">Lp (cm)</th>
                                <th class="w-10"></th>
                            </tr>
                        </thead>
                        <tbody id="list-body"></tbody>
                    </table>
                </div>
                <p class="text-xs text-gray-400 mt-4 text-center">Tip: Lp = 170 ry / Fy。數據可直接複製到 Excel。</p>
            </div>
        </div>

    </div>

    <script>
        function formatNum(num) {
            return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function getProperties(h_mm, b_mm, tw_mm, tf_mm, fy_val) {
            if (h_mm <= 0 || b_mm <= 0 || tw_mm <= 0 || tf_mm <= 0) return null;

            let h = h_mm / 10;
            let b = b_mm / 10;
            let tw = tw_mm / 10;
            let tf = tf_mm / 10;

            let area = (2 * b * tf) + ((h - 2 * tf) * tw);
            let weight = area * 0.785; 

            let ix = (1/12) * ( (b * Math.pow(h, 3)) - ((b - tw) * Math.pow(h - 2*tf, 3)) );
            let iy = (2 * ((1/12) * tf * Math.pow(b, 3))) + ((1/12) * (h - 2*tf) * Math.pow(tw, 3));
            
            let rx = Math.sqrt(ix / area);
            let ry = Math.sqrt(iy / area);

            let sx = ix / (h / 2);
            let sy = iy / (b / 2);

            let zx = (b * tf * (h - tf)) + (tw * Math.pow(h - 2*tf, 2) / 4);
            let zy = (tf * Math.pow(b, 2) / 2) + ((h - 2*tf) * Math.pow(tw, 2) / 4);

            let mpx = (fy_val * zx) / 100; // tf-m
            let mpy = (fy_val * zy) / 100; // tf-m
            
            let aw = h * tw;
            let vp = 0.6 * fy_val * aw; // tf

            // Lp Calculation
            // Formula: 170 * ry / Fy
            let lp = (170 * ry) / fy_val; // cm

            return { area, weight, ix, iy, rx, ry, sx, sy, zx, zy, mpx, mpy, vp, lp };
        }

        // === DETAIL VIEW ===
        function calculate() {
            let h = parseFloat(document.getElementById('inputH').value) || 0;
            let b = parseFloat(document.getElementById('inputB').value) || 0;
            let tw = parseFloat(document.getElementById('inputTw').value) || 0;
            let tf = parseFloat(document.getElementById('inputTf').value) || 0;
            let fy = parseFloat(document.getElementById('inputFy').value) || 0;

            drawSection(h, b, tw, tf);
            
            let p = getProperties(h, b, tw, tf, fy);
            if (!p) return;

            document.getElementById('resA').innerText = formatNum(p.area);
            document.getElementById('resWeight').innerText = formatNum(p.weight);
            document.getElementById('resIx').innerText = formatNum(p.ix);
            document.getElementById('resIy').innerText = formatNum(p.iy);
            document.getElementById('resRx').innerText = formatNum(p.rx);
            document.getElementById('resRy').innerText = formatNum(p.ry);
            document.getElementById('resSx').innerText = formatNum(p.sx);
            document.getElementById('resSy').innerText = formatNum(p.sy);
            document.getElementById('resZx').innerText = formatNum(p.zx);
            document.getElementById('resZy').innerText = formatNum(p.zy);
            document.getElementById('resMpx').innerText = formatNum(p.mpx);
            document.getElementById('resMpy').innerText = formatNum(p.mpy);
            document.getElementById('resVp').innerText = formatNum(p.vp);
            
            // New Lp
            document.getElementById('resLp').innerText = formatNum(p.lp);
        }

        function drawSection(h, b, tw, tf) {
            const path = document.getElementById('steelPath');
            const axisGroup = document.getElementById('axisGroup');
            const dimGroup = document.getElementById('dimLines');
            
            if(h<=0 || b<=0) return;

            const size = 300;
            const center = size / 2;
            const padding = 60; 
            const maxDisplaySize = size - (padding * 2);
            const maxDim = Math.max(h, b);
            const scale = maxDisplaySize / maxDim;

            const halfH = (h / 2) * scale;
            const halfB = (b / 2) * scale;
            const halfTw = (tw / 2) * scale;
            const innerH = halfH - (tf * scale);

            let d = `M ${center - halfB}, ${center - halfH} L ${center + halfB}, ${center - halfH} L ${center + halfB}, ${center - innerH} L ${center + halfTw}, ${center - innerH} L ${center + halfTw}, ${center + innerH} L ${center + halfB}, ${center + innerH} L ${center + halfB}, ${center + halfH} L ${center - halfB}, ${center + halfH} L ${center - halfB}, ${center + innerH} L ${center - halfTw}, ${center + innerH} L ${center - halfTw}, ${center - innerH} L ${center - halfB}, ${center - innerH} Z`;
            path.setAttribute('d', d);

            axisGroup.innerHTML = '';
            const createAxis = (x1,y1,x2,y2, label, lx, ly) => {
                const l = document.createElementNS("http://www.w3.org/2000/svg", "line");
                l.setAttribute("x1", x1); l.setAttribute("y1", y1); l.setAttribute("x2", x2); l.setAttribute("y2", y2); l.setAttribute("class", "axis-line");
                axisGroup.appendChild(l);
                const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
                t.setAttribute("x", lx); t.setAttribute("y", ly); t.setAttribute("class", "axis-label");
                t.textContent = label;
                axisGroup.appendChild(t);
            }
            createAxis(20, center, size-20, center, "X", size-15, center+4);
            createAxis(center, 20, center, size-20, "Y", center-4, 15);

            dimGroup.innerHTML = ''; 
            const addDim = (x1,y1,x2,y2,txt,tx,ty, anchor="middle") => {
                const l = document.createElementNS("http://www.w3.org/2000/svg", "line");
                l.setAttribute("x1", x1); l.setAttribute("y1", y1); l.setAttribute("x2", x2); l.setAttribute("y2", y2); l.setAttribute("class", "dim-line");
                l.setAttribute("marker-start", "url(#arrow)"); l.setAttribute("marker-end", "url(#arrow)");
                dimGroup.appendChild(l);
                const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
                t.setAttribute("x", tx); t.setAttribute("y", ty); t.setAttribute("class", "dim-text");
                t.setAttribute("text-anchor", anchor);
                t.textContent = txt;
                dimGroup.appendChild(t);
            }
            addDim(center-halfB-25, center-halfH, center-halfB-25, center+halfH, h, center-halfB-40, center);
            addDim(center-halfB, center-halfH-25, center+halfB, center-halfH-25, b, center, center-halfH-35);
        }

        // === LIST VIEW ===
        let rowCount = 0;

        function switchView(mode) {
            const detailView = document.getElementById('view-detail');
            const listView = document.getElementById('view-list');
            const btnDetail = document.getElementById('btn-detail');
            const btnList = document.getElementById('btn-list');

            if (mode === 'detail') {
                detailView.classList.remove('hidden');
                listView.classList.add('hidden');
                btnDetail.classList.add('active'); btnDetail.classList.remove('inactive');
                btnList.classList.add('inactive'); btnList.classList.remove('active');
            } else {
                detailView.classList.add('hidden');
                listView.classList.remove('hidden');
                btnDetail.classList.add('inactive'); btnDetail.classList.remove('active');
                btnList.classList.add('active'); btnList.classList.remove('inactive');
                if(rowCount === 0) addListRow(); 
            }
        }

        function addListRow() {
            rowCount++;
            const tbody = document.getElementById('list-body');
            const tr = document.createElement('tr');
            tr.id = `row-${rowCount}`;
            tr.innerHTML = `
                <td class="text-center text-gray-400 font-mono text-xs">${rowCount}</td>
                <td><input type="number" class="list-input" placeholder="H" oninput="calcRow(${rowCount})" id="h-${rowCount}"></td>
                <td><input type="number" class="list-input" placeholder="B" oninput="calcRow(${rowCount})" id="b-${rowCount}"></td>
                <td><input type="number" class="list-input" placeholder="tw" oninput="calcRow(${rowCount})" id="tw-${rowCount}"></td>
                <td><input type="number" class="list-input" placeholder="tf" oninput="calcRow(${rowCount})" id="tf-${rowCount}"></td>
                <td class="border-r border-gray-200"><input type="number" class="list-input text-blue-600 font-bold" value="3.3" oninput="calcRow(${rowCount})" id="fy-${rowCount}"></td>
                
                <td class="cell-output" id="out-area-${rowCount}">-</td>
                <td class="cell-output text-gray-600" id="out-wt-${rowCount}">-</td>
                <td class="cell-output" id="out-ix-${rowCount}">-</td>
                <td class="cell-output" id="out-iy-${rowCount}">-</td>
                <td class="cell-output text-blue-600 font-mono text-sm" id="out-rx-${rowCount}">-</td>
                <td class="cell-output text-green-600 font-mono text-sm" id="out-ry-${rowCount}">-</td>
                <td class="cell-output text-blue-600 font-mono text-sm" id="out-zx-${rowCount}">-</td>
                <td class="cell-output text-green-600 font-mono text-sm" id="out-zy-${rowCount}">-</td>
                <td class="cell-output text-blue-600" id="out-mpx-${rowCount}">-</td>
                <td class="cell-output text-gray-500" id="out-mpy-${rowCount}">-</td>
                <td class="cell-output text-green-600" id="out-vp-${rowCount}">-</td>
                <td class="cell-output bg-blue-50 text-blue-700 font-bold border-l border-blue-100 px-2" id="out-lp-${rowCount}">-</td>
                <td class="text-center">
                    <button onclick="deleteRow(${rowCount})" class="text-gray-300 hover:text-red-500 transition"><i class="fa-solid fa-trash"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
        }

        function deleteRow(id) {
            const row = document.getElementById(`row-${id}`);
            if(row) row.remove();
        }

        function calcRow(id) {
            const h = parseFloat(document.getElementById(`h-${id}`).value) || 0;
            const b = parseFloat(document.getElementById(`b-${id}`).value) || 0;
            const tw = parseFloat(document.getElementById(`tw-${id}`).value) || 0;
            const tf = parseFloat(document.getElementById(`tf-${id}`).value) || 0;
            const fy = parseFloat(document.getElementById(`fy-${id}`).value) || 0;

            const p = getProperties(h, b, tw, tf, fy);

            if(p) {
                document.getElementById(`out-area-${id}`).innerText = p.area.toFixed(2);
                document.getElementById(`out-wt-${id}`).innerText = p.weight.toFixed(2);
                document.getElementById(`out-ix-${id}`).innerText = p.ix.toFixed(0);
                document.getElementById(`out-iy-${id}`).innerText = p.iy.toFixed(0);
                document.getElementById(`out-rx-${id}`).innerText = p.rx.toFixed(2);
                document.getElementById(`out-ry-${id}`).innerText = p.ry.toFixed(2);
                document.getElementById(`out-zx-${id}`).innerText = p.zx.toFixed(1);
                document.getElementById(`out-zy-${id}`).innerText = p.zy.toFixed(1);
                document.getElementById(`out-mpx-${id}`).innerText = p.mpx.toFixed(2);
                document.getElementById(`out-mpy-${id}`).innerText = p.mpy.toFixed(2);
                document.getElementById(`out-vp-${id}`).innerText = p.vp.toFixed(1);
                document.getElementById(`out-lp-${id}`).innerText = p.lp.toFixed(1);
            } else {
                [`out-area-${id}`, `out-wt-${id}`, `out-ix-${id}`, `out-iy-${id}`, `out-rx-${id}`, `out-ry-${id}`, `out-zx-${id}`, `out-zy-${id}`, `out-mpx-${id}`, `out-mpy-${id}`, `out-vp-${id}`, `out-lp-${id}`].forEach(eid => {
                    document.getElementById(eid).innerText = '-';
                });
            }
        }

        function copyTableData() {
            const rows = document.querySelectorAll('#list-body tr');
            let text = "H\tB\ttw\ttf\tFy\tArea(cm²)\tWt(kg/m)\tIx(cm⁴)\tIy(cm⁴)\trx(cm)\try(cm)\tZx(cm³)\tZy(cm³)\tMpx(tf-m)\tMpy(tf-m)\tVp(tf)\tLp(cm)\n";
            
            rows.forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                const outputs = tr.querySelectorAll('.cell-output');
                if(inputs.length > 0 && inputs[0].value) {
                    inputs.forEach(inp => text += inp.value + "\t");
                    outputs.forEach(out => text += out.innerText + "\t");
                    text += "\n";
                }
            });

            // Improved copy method for compatibility
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert("已複製表格數據！包含單位與 Zx/Zy");
            } catch (err) {
                console.error('Unable to copy', err);
                alert("複製失敗，請手動複製。");
            }
            document.body.removeChild(textArea);
        }

        window.onload = function() {
            calculate();
        }
    </script>
</body>
</html>